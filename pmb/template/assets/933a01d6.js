import{q as S,r as s,R as j,j as e,w as n,x as d,T as R,aH as c,aA as T,as as I,b9 as p,bh as w}from"./e1dd7045.js";import{A as L,a as q}from"./c39f4b70.js";import{C as F,L as y}from"./e3839f17.js";import{C as U}from"./4da97614.js";const W=async()=>{const o=await L.get("captcha_img"),i=o.headers.get("X-Captcha-Id"),r=await o.blob(),l=URL.createObjectURL(r);return{id:i,img:l}};function E(){const{signIn:o}=S(),[i,r]=s.useState(!1),[l,C]=s.useState(""),[h,P]=s.useState(""),[g,f]=s.useState(!0),[t,v]=s.useState(null),m=async()=>{try{const a=await W();v(a)}catch(a){w(a,"获取验证码失败")}};return j.useEffect(()=>(m(),()=>{t!=null&&t.img&&URL.revokeObjectURL(t.img)}),[]),e(F,{component:"main",maxWidth:"xs",children:n(d,{sx:{paddingTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e(R,{component:"h1",variant:"h5",children:"账号密码注册"}),n(d,{component:"form",onSubmit:async a=>{a.preventDefault();const x=new FormData(a.currentTarget);if(r(!0),l!==h){f(!1),r(!1);return}else f(!0);try{const u=await L.post("reg",{json:{user_name:x.get("username"),password:l,valid_id:t==null?void 0:t.id,valid_value:x.get("captcha")}}),b=await q(u,"注册失败");b.token&&o(b)}catch(u){w(u,"注册失败"),m()}finally{r(!1)}},sx:{mt:1},children:[e(c,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"用户名",name:"username",autoComplete:"username",inputProps:{minLength:3,maxLength:24}}),e(c,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"密码",type:"password",id:"password",autoComplete:"current-password",inputProps:{minLength:6,maxLength:42},onChange:a=>C(a.target.value)}),e(c,{margin:"normal",required:!0,fullWidth:!0,name:"confirmPassword",label:"确认密码",type:"password",id:"confirmPassword",autoComplete:"current-password",inputProps:{minLength:6,maxLength:42},value:h,onChange:a=>P(a.target.value),error:!g,helperText:g?"":"两次密码不一致"}),n(d,{sx:{display:"flex",alignItems:"center",mt:2},children:[e(c,{required:!0,sx:{flex:1},name:"captcha",label:"验证码",inputProps:{maxLength:6}}),e(d,{component:"img",src:t==null?void 0:t.img,sx:{ml:1,height:40,cursor:"pointer",border:"1px solid #ddd",borderRadius:1},onClick:m,alt:"验证码"})]}),e(T,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:2,mb:2},disabled:i,children:i?n(I,{children:[e(U,{size:24,sx:{color:"secondary",position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}}),"注册中..."]}):"注 册"}),n(p,{container:!0,children:[e(p,{item:!0,xs:!0,children:e(y,{href:"#",variant:"body2",children:"注册失败?"})}),e(p,{item:!0,children:e(y,{href:"login",variant:"body2",children:"登录"})})]})]})]})})}export{E as default};
