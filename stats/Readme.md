# 使用redis进行各类统计信息的方法汇总

### PV UV 统计

* 使用 redis `HyperLogLog` 结构实现 约 `0.81%` 的误差率
* 支持任何事件级统计 例如
    * 页面PV UV 或 按钮点击次数
* 默认自动以当前时间作为 `key` 格式为 `[prefix]:[event]:[date]`
    * 也可以主动变更为最后的日期为任意字符串 格式为 `[prefix]:[event]:[string]`
* 可汇聚任意时间段内进行统计
    * 也可以进行任意 `key` 的合并或统计
* 以 `must` 开头的函数 均没有返回值

### work 作品统计 封装常见 `转发` `观看` `点赞` `评论` `质量`

* 转发分享 使用 redis `set` 结构
    * 细看连头条类最大转发也不过5位数 `set` 预计最大占用 100mb 也不算大KEY 碰到了再说
* 观看 使用上面得PV UV统计
* 点赞 使用 redis `set` 结构
    * 这个就特别要注意了 可能存在 大KEY 得可能性 但是在 时间 空间 和成本中选择 我选成本 碰到了再说
* 评论 使用 redis `set` 结构
    * 上W评论可能性太低 碰到了再说 
    * 用户是可以多条评论的
* 质量 需要业务判断作品质量分 这边只是存储
* 定时同步上述信息结构 汇聚到 `作品ID` key下 使用 redis `hash` 结构进行计数 仅计数
* 建议业务上层进行一次拦截 对于作品超过N个时间后 就不要进行统计了 根据通用经验 ` N ~=15 ` 甚至可以 ` N ~=7 ` 
* workId 不宜过长 暂时还没有考虑优化到key长度的地步 所以先以基本的语义化为主