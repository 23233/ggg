import{q as y,r as h,R as w,j as e,w as r,x as o,T as L,aH as m,aA as C,as as S,b9 as u,bh as g}from"./e1dd7045.js";import{A as f,a as j}from"./c39f4b70.js";import{C as v,L as x}from"./e3839f17.js";import{C as I}from"./4da97614.js";const R=async()=>{const n=await f.get("captcha_img"),s=n.headers.get("X-Captcha-Id"),i=await n.blob(),t=URL.createObjectURL(i);return{id:s,img:t}};function D(){const{signIn:n}=y(),[s,i]=h.useState(!1),[t,b]=h.useState(null),c=async()=>{try{const a=await R();b(a)}catch(a){g(a,"获取验证码失败")}};return w.useEffect(()=>{c()},[]),e(v,{component:"main",maxWidth:"xs",children:r(o,{sx:{paddingTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e(L,{component:"h1",variant:"h5",children:"账号密码登录"}),r(o,{component:"form",onSubmit:async a=>{a.preventDefault();const l=new FormData(a.currentTarget);i(!0);try{const d=await f.post("login",{json:{user_name:l.get("username"),password:l.get("password"),valid_id:t==null?void 0:t.id,valid_value:l.get("captcha")}}),p=await j(d,"登录失败");p.token&&n(p)}catch(d){g(d,"登录失败"),c()}finally{i(!1)}},sx:{mt:1},children:[e(m,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"用户名",name:"username",autoComplete:"username",inputProps:{minLength:3,maxLength:24}}),e(m,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"密码",type:"password",id:"password",autoComplete:"current-password",inputProps:{minLength:6,maxLength:42}}),r(o,{sx:{display:"flex",alignItems:"center",mt:2},children:[e(m,{required:!0,sx:{flex:1},name:"captcha",label:"验证码",inputProps:{maxLength:6}}),e(o,{component:"img",src:t==null?void 0:t.img,sx:{ml:1,height:40,cursor:"pointer",border:"1px solid #ddd",borderRadius:1},onClick:c,alt:"验证码"})]}),e(C,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:2,mb:2},disabled:s,children:s?r(S,{children:[e(I,{size:24,sx:{color:"secondary",position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}}),"登录中..."]}):"登 录"}),r(u,{container:!0,children:[e(u,{item:!0,xs:!0,children:e(x,{href:"#",variant:"body2",children:"忘记密码?"})}),e(u,{item:!0,children:e(x,{href:"reg",variant:"body2",children:"注册"})})]})]})]})})}export{D as default};
